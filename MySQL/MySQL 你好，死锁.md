# MySQL 你好，死锁

![](./images/deadlock-1.jpg)

## 前言

在日常的生活中，相信大家曾或多或少有这么一种体验："每到下班高峰期的时候，原本宽坦的交通干道，一时间变得水泄不通，司机和乘客都烦躁不安，喇叭声响成一片，当车卡在十字路口中间，会很尴尬的发现，此时无论想走哪都…..."。对于这样的体验，大家都是十分的害怕接触和体验，交通部门也无时无刻为解决交通拥堵问题而努力。

其实上面生活案例中拥堵就类似于——`高并发`场景；

而所有方向的车堵在十字路口中间就类似于——`数据库死锁`场景。

本章主要介绍了死锁相关的一些概念、产生死锁的原因、死锁场景以及死锁的处理策略。



## 某些概念

为了更好的认识`死锁`，我们先来了解`MySQL`中与死锁相关的一些基本概念。

### 并发控制

并发控制（Concurrency control）指的是当多个用户同时更新运行时，用于保护数据库完整性的各种技术。

#### 读写锁

为了保证数据库的并发控制，因此`MySQL`设置了两种锁：

- 共享锁（Shared Lock）：也叫读锁（Read Lock），允许多个连接可以同一时刻并发的读取同一资源，互不干扰。
- 排他锁（Exclusive Lock）：也叫写锁（Write Lock），会阻塞其他写锁或者读书的请求，保证同一时刻只有一个连接可以操作数据，包括读。

#### 锁策略

所谓`锁策略`就是在锁的开销和数据的安全性之间寻求平衡，这种平衡会影响到性能。



### 事务

#### 隔离级别

#### 事务日志











## 死锁的定义











## 死锁的危害



## 死锁产生的原因





## 死锁的发生场景

### 场景一



### 场景二



## 死锁的处理策略

### 预防死锁



### 避免死锁



### 死锁的检测和解除



## 参考文章

《高性能的MySQL 第三版》



https://www.kancloud.cn/hanghanghang/os/239542#_38







## 



https://my.oschina.net/u/1399755/blog/1788881



[https://benjaminwhx.com/2018/02/28/%E7%94%B1%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E5%B8%A6%E6%9D%A5%E7%9A%84MySQL%E6%AD%BB%E9%94%81%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90/](https://benjaminwhx.com/2018/02/28/由一次线上问题带来的MySQL死锁问题分析/)